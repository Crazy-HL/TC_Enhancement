{"ast":null,"code":"import { ref, watch, onMounted, onUnmounted } from \"vue\";\nexport default {\n  __name: 'DanmuDisplay',\n  props: {\n    activeSentence: Number,\n    comments: Array\n  },\n  emits: [\"stop-danmu\"],\n  setup(__props, _ref) {\n    let {\n      expose: __expose,\n      emit: __emit\n    } = _ref;\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const colorPool = [\"#FF6B6B\", \"#4ECDC4\", \"#45B7D1\", \"#FFA07A\", \"#98D8C8\", \"#F06292\", \"#7986CB\", \"#9575CD\", \"#64B5F6\", \"#4DB6AC\", \"#81C784\", \"#FFD54F\"];\n    const danmuContainer = ref(null);\n    const danmus = ref([]);\n    let danmuInterval = null;\n\n    // 获取某句子的相关评论\n    const getCommentsForSentence = sentenceIndex => {\n      return props.comments.filter(comment => comment.link === sentenceIndex);\n    };\n\n    // 初始化弹幕\n    const initDanmus = () => {\n      const relatedComments = getCommentsForSentence(props.activeSentence);\n      if (relatedComments.length === 0) return;\n      const containerHeight = danmuContainer.value?.clientHeight || 100;\n      const containerWidth = danmuContainer.value?.clientWidth || 800;\n      danmus.value = relatedComments.map((comment, i) => ({\n        id: `${Date.now()}-${i}`,\n        content: comment.content,\n        user: comment.user_nickname,\n        color: colorPool[Math.floor(Math.random() * colorPool.length)],\n        top: Math.random() * (containerHeight - 30),\n        left: containerWidth,\n        speed: 10 + Math.random() * 10\n      }));\n      startDanmuAnimation();\n    };\n\n    // 开始弹幕动画\n    const startDanmuAnimation = () => {\n      stopDanmuAnimation();\n      danmuInterval = setInterval(() => {\n        const containerWidth = danmuContainer.value?.clientWidth || 800;\n        danmus.value = danmus.value.map(danmu => {\n          const moveSpeed = containerWidth / (danmu.speed * 20);\n          let newLeft = danmu.left - moveSpeed;\n          if (newLeft < -500) {\n            newLeft = containerWidth;\n            danmu.top = Math.random() * (danmuContainer.value.clientHeight - 30);\n          }\n          return {\n            ...danmu,\n            left: newLeft\n          };\n        });\n      }, 50);\n    };\n\n    // 停止弹幕动画\n    const stopDanmuAnimation = () => {\n      if (danmuInterval) {\n        clearInterval(danmuInterval);\n        danmuInterval = null;\n      }\n    };\n\n    // 监听activeSentence变化\n    watch(() => props.activeSentence, newVal => {\n      if (newVal !== null) {\n        initDanmus();\n      } else {\n        stopDanmuAnimation();\n        danmus.value = [];\n      }\n    });\n    onMounted(() => {\n      // 初始化容器尺寸\n      if (danmuContainer.value) {\n        danmuContainer.value.style.height = \"100px\";\n      }\n    });\n    onUnmounted(() => {\n      stopDanmuAnimation();\n    });\n    const __returned__ = {\n      props,\n      emit,\n      colorPool,\n      danmuContainer,\n      danmus,\n      get danmuInterval() {\n        return danmuInterval;\n      },\n      set danmuInterval(v) {\n        danmuInterval = v;\n      },\n      getCommentsForSentence,\n      initDanmus,\n      startDanmuAnimation,\n      stopDanmuAnimation,\n      ref,\n      watch,\n      onMounted,\n      onUnmounted\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","watch","onMounted","onUnmounted","props","__props","emit","__emit","colorPool","danmuContainer","danmus","danmuInterval","getCommentsForSentence","sentenceIndex","comments","filter","comment","link","initDanmus","relatedComments","activeSentence","length","containerHeight","value","clientHeight","containerWidth","clientWidth","map","i","id","Date","now","content","user","user_nickname","color","Math","floor","random","top","left","speed","startDanmuAnimation","stopDanmuAnimation","setInterval","danmu","moveSpeed","newLeft","clearInterval","newVal","style","height"],"sources":["D:/ZhiHu/zhihu-bullet/wikitable-vue/client/src/components/DanmuDisplay.vue"],"sourcesContent":["<template>\r\n\t<div class=\"danmu-container\" ref=\"danmuContainer\">\r\n\t\t<div\r\n\t\t\tv-for=\"danmu in danmus\"\r\n\t\t\t:key=\"danmu.id\"\r\n\t\t\tclass=\"danmu-item\"\r\n\t\t\t:style=\"{\r\n\t\t\t\ttop: `${danmu.top}px`,\r\n\t\t\t\tleft: `${danmu.left}px`,\r\n\t\t\t\tcolor: danmu.color,\r\n\t\t\t\t'animation-duration': `${danmu.speed}s`\r\n\t\t\t}\">\r\n\t\t\t<span class=\"danmu-user\">{{ danmu.user }}：</span>\r\n\t\t\t<span class=\"danmu-content\">{{ danmu.content }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, watch, onMounted, onUnmounted } from \"vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tactiveSentence: Number,\r\n\t\tcomments: Array\r\n\t});\r\n\r\n\tconst emit = defineEmits([\"stop-danmu\"]);\r\n\r\n\tconst colorPool = [\r\n\t\t\"#FF6B6B\",\r\n\t\t\"#4ECDC4\",\r\n\t\t\"#45B7D1\",\r\n\t\t\"#FFA07A\",\r\n\t\t\"#98D8C8\",\r\n\t\t\"#F06292\",\r\n\t\t\"#7986CB\",\r\n\t\t\"#9575CD\",\r\n\t\t\"#64B5F6\",\r\n\t\t\"#4DB6AC\",\r\n\t\t\"#81C784\",\r\n\t\t\"#FFD54F\"\r\n\t];\r\n\r\n\tconst danmuContainer = ref(null);\r\n\tconst danmus = ref([]);\r\n\tlet danmuInterval = null;\r\n\r\n\t// 获取某句子的相关评论\r\n\tconst getCommentsForSentence = sentenceIndex => {\r\n\t\treturn props.comments.filter(comment => comment.link === sentenceIndex);\r\n\t};\r\n\r\n\t// 初始化弹幕\r\n\tconst initDanmus = () => {\r\n\t\tconst relatedComments = getCommentsForSentence(props.activeSentence);\r\n\t\tif (relatedComments.length === 0) return;\r\n\r\n\t\tconst containerHeight = danmuContainer.value?.clientHeight || 100;\r\n\t\tconst containerWidth = danmuContainer.value?.clientWidth || 800;\r\n\r\n\t\tdanmus.value = relatedComments.map((comment, i) => ({\r\n\t\t\tid: `${Date.now()}-${i}`,\r\n\t\t\tcontent: comment.content,\r\n\t\t\tuser: comment.user_nickname,\r\n\t\t\tcolor: colorPool[Math.floor(Math.random() * colorPool.length)],\r\n\t\t\ttop: Math.random() * (containerHeight - 30),\r\n\t\t\tleft: containerWidth,\r\n\t\t\tspeed: 10 + Math.random() * 10\r\n\t\t}));\r\n\r\n\t\tstartDanmuAnimation();\r\n\t};\r\n\r\n\t// 开始弹幕动画\r\n\tconst startDanmuAnimation = () => {\r\n\t\tstopDanmuAnimation();\r\n\r\n\t\tdanmuInterval = setInterval(() => {\r\n\t\t\tconst containerWidth = danmuContainer.value?.clientWidth || 800;\r\n\r\n\t\t\tdanmus.value = danmus.value.map(danmu => {\r\n\t\t\t\tconst moveSpeed = containerWidth / (danmu.speed * 20);\r\n\t\t\t\tlet newLeft = danmu.left - moveSpeed;\r\n\r\n\t\t\t\tif (newLeft < -500) {\r\n\t\t\t\t\tnewLeft = containerWidth;\r\n\t\t\t\t\tdanmu.top = Math.random() * (danmuContainer.value.clientHeight - 30);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn { ...danmu, left: newLeft };\r\n\t\t\t});\r\n\t\t}, 50);\r\n\t};\r\n\r\n\t// 停止弹幕动画\r\n\tconst stopDanmuAnimation = () => {\r\n\t\tif (danmuInterval) {\r\n\t\t\tclearInterval(danmuInterval);\r\n\t\t\tdanmuInterval = null;\r\n\t\t}\r\n\t};\r\n\r\n\t// 监听activeSentence变化\r\n\twatch(\r\n\t\t() => props.activeSentence,\r\n\t\tnewVal => {\r\n\t\t\tif (newVal !== null) {\r\n\t\t\t\tinitDanmus();\r\n\t\t\t} else {\r\n\t\t\t\tstopDanmuAnimation();\r\n\t\t\t\tdanmus.value = [];\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tonMounted(() => {\r\n\t\t// 初始化容器尺寸\r\n\t\tif (danmuContainer.value) {\r\n\t\t\tdanmuContainer.value.style.height = \"100px\";\r\n\t\t}\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tstopDanmuAnimation();\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.danmu-container {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100px;\r\n\t\toverflow: hidden;\r\n\t\tz-index: 10;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.danmu-item {\r\n\t\tposition: absolute;\r\n\t\twhite-space: nowrap;\r\n\t\tfont-size: 16px;\r\n\t\ttext-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 15px;\r\n\t\tbackground-color: rgba(255, 255, 255, 0.8);\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n\t\tanimation: danmu-move linear infinite;\r\n\t}\r\n\r\n\t.danmu-user {\r\n\t\tfont-weight: bold;\r\n\t\tmargin-right: 5px;\r\n\t}\r\n\r\n\t@keyframes danmu-move {\r\n\t\tfrom {\r\n\t\t\ttransform: translateX(100%);\r\n\t\t}\r\n\t\tto {\r\n\t\t\ttransform: translateX(-100%);\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}