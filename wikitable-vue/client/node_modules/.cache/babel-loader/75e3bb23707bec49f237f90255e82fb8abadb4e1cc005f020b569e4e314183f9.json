{"ast":null,"code":"import { computed } from \"vue\";\nexport default {\n  __name: 'HighFrequencyWords',\n  props: {\n    sentence: {\n      type: String,\n      required: true\n    },\n    sentenceIndex: {\n      type: Number,\n      required: true\n    },\n    highFrequencyWords: {\n      type: Object,\n      default: () => ({})\n    },\n    showHighlight: {\n      type: Boolean,\n      default: true\n    },\n    hasComments: {\n      type: Boolean,\n      default: false\n    },\n    commentLevel: {\n      type: Object,\n      default: () => ({\n        level: 0\n      })\n    },\n    highlightContent: {\n      type: Boolean,\n      default: true\n    },\n    isActive: {\n      type: Boolean,\n      default: false\n    },\n    showMarker: {\n      type: Boolean,\n      default: true\n    },\n    commentCount: {\n      type: Number,\n      default: 0\n    },\n    visibleCommentTypes: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  emits: [\"click\"],\n  setup(__props, _ref) {\n    let {\n      expose: __expose,\n      emit: __emit\n    } = _ref;\n    __expose();\n    const props = __props;\n    const emit = __emit;\n    const handleClick = () => {\n      emit(\"click\", props.sentenceIndex);\n    };\n    const escapeRegExp = string => {\n      return string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\n    };\n\n    // 根据频率生成圆圈线条粗细\n    const getCircleBorderWidth = frequency => {\n      const minWidth = 1.5;\n      const maxWidth = 4;\n      const clampedFreq = Math.min(Math.max(frequency, 1), 50);\n      const borderWidth = minWidth + (clampedFreq - 1) / (50 - 1) * (maxWidth - minWidth);\n      return `${borderWidth}px`;\n    };\n    const circledSentence = computed(() => {\n      if (!props.showHighlight || !props.highFrequencyWords[props.sentenceIndex]) {\n        return props.sentence;\n      }\n      const keywords = [...props.highFrequencyWords[props.sentenceIndex]];\n      let processed = props.sentence;\n      keywords.sort((a, b) => b[1] - a[1]);\n      keywords.slice(0, 3).forEach((_ref2, index) => {\n        let [word] = _ref2;\n        if (props.sentence.includes(word)) {\n          const frequency = props.highFrequencyWords[props.sentenceIndex].find(item => item[0] === word)?.[1] || 1;\n          const regex = new RegExp(escapeRegExp(word), \"g\");\n          processed = processed.replace(regex, `<span class=\"circled-word\" \n\t\t\t\t\t\tstyle=\"--circle-border-width: ${getCircleBorderWidth(frequency)}\"\n\t\t\t\t\t\ttitle=\"相关评论中出现频率较高\">${word}</span>`);\n        }\n      });\n      return processed;\n    });\n    const __returned__ = {\n      props,\n      emit,\n      handleClick,\n      escapeRegExp,\n      getCircleBorderWidth,\n      circledSentence,\n      computed\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["computed","props","__props","emit","__emit","handleClick","sentenceIndex","escapeRegExp","string","replace","getCircleBorderWidth","frequency","minWidth","maxWidth","clampedFreq","Math","min","max","borderWidth","circledSentence","showHighlight","highFrequencyWords","sentence","keywords","processed","sort","a","b","slice","forEach","_ref2","index","word","includes","find","item","regex","RegExp"],"sources":["D:/ZhiHu/zhihu-bullet/wikitable-vue/client/src/components/HighFrequencyWords.vue"],"sourcesContent":["<template>\r\n\t<span class=\"sentence-wrapper\">\r\n\t\t<span\r\n\t\t\tclass=\"sentence\"\r\n\t\t\t:class=\"{\r\n\t\t\t\t'has-comment': hasComments,\r\n\t\t\t\t[`comment-level-${commentLevel.level}`]:\r\n\t\t\t\t\thasComments && highlightContent,\r\n\t\t\t\tselected: isActive\r\n\t\t\t}\"\r\n\t\t\t@click=\"handleClick\"\r\n\t\t\tv-html=\"circledSentence\">\r\n\t\t\t<sup v-if=\"showMarker && hasComments\" class=\"annotation-marker\">\r\n\t\t\t\t{{ commentCount }}\r\n\t\t\t</sup>\r\n\t\t</span>\r\n\t</span>\r\n</template>\r\n\r\n<script setup>\r\n\timport { computed } from \"vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tsentence: {\r\n\t\t\ttype: String,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\tsentenceIndex: {\r\n\t\t\ttype: Number,\r\n\t\t\trequired: true\r\n\t\t},\r\n\t\thighFrequencyWords: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({})\r\n\t\t},\r\n\t\tshowHighlight: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\thasComments: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tcommentLevel: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({ level: 0 })\r\n\t\t},\r\n\t\thighlightContent: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tisActive: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: false\r\n\t\t},\r\n\t\tshowMarker: {\r\n\t\t\ttype: Boolean,\r\n\t\t\tdefault: true\r\n\t\t},\r\n\t\tcommentCount: {\r\n\t\t\ttype: Number,\r\n\t\t\tdefault: 0\r\n\t\t},\r\n\t\tvisibleCommentTypes: {\r\n\t\t\ttype: Object,\r\n\t\t\tdefault: () => ({})\r\n\t\t}\r\n\t});\r\n\r\n\tconst emit = defineEmits([\"click\"]);\r\n\r\n\tconst handleClick = () => {\r\n\t\temit(\"click\", props.sentenceIndex);\r\n\t};\r\n\r\n\tconst escapeRegExp = string => {\r\n\t\treturn string.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n\t};\r\n\r\n\t// 根据频率生成圆圈线条粗细\r\n\tconst getCircleBorderWidth = frequency => {\r\n\t\tconst minWidth = 1.5;\r\n\t\tconst maxWidth = 4;\r\n\t\tconst clampedFreq = Math.min(Math.max(frequency, 1), 50);\r\n\t\tconst borderWidth =\r\n\t\t\tminWidth + ((clampedFreq - 1) / (50 - 1)) * (maxWidth - minWidth);\r\n\t\treturn `${borderWidth}px`;\r\n\t};\r\n\r\n\tconst circledSentence = computed(() => {\r\n\t\tif (\r\n\t\t\t!props.showHighlight ||\r\n\t\t\t!props.highFrequencyWords[props.sentenceIndex]\r\n\t\t) {\r\n\t\t\treturn props.sentence;\r\n\t\t}\r\n\r\n\t\tconst keywords = [...props.highFrequencyWords[props.sentenceIndex]];\r\n\t\tlet processed = props.sentence;\r\n\r\n\t\tkeywords.sort((a, b) => b[1] - a[1]);\r\n\r\n\t\tkeywords.slice(0, 3).forEach(([word], index) => {\r\n\t\t\tif (props.sentence.includes(word)) {\r\n\t\t\t\tconst frequency =\r\n\t\t\t\t\tprops.highFrequencyWords[props.sentenceIndex].find(\r\n\t\t\t\t\t\titem => item[0] === word\r\n\t\t\t\t\t)?.[1] || 1;\r\n\r\n\t\t\t\tconst regex = new RegExp(escapeRegExp(word), \"g\");\r\n\t\t\t\tprocessed = processed.replace(\r\n\t\t\t\t\tregex,\r\n\t\t\t\t\t`<span class=\"circled-word\" \r\n\t\t\t\t\t\tstyle=\"--circle-border-width: ${getCircleBorderWidth(frequency)}\"\r\n\t\t\t\t\t\ttitle=\"相关评论中出现频率较高\">${word}</span>`\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn processed;\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.sentence-wrapper {\r\n\t\tdisplay: inline;\r\n\t}\r\n\r\n\t.sentence {\r\n\t\tdisplay: inline;\r\n\t\tmargin-right: 0.2em;\r\n\t\tposition: relative;\r\n\t\ttransition: all 0.2s;\r\n\t\tpadding: 0 1px;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t.sentence.has-comment {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.2);\r\n\t}\r\n\r\n\t.sentence.comment-level-1 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.2);\r\n\t}\r\n\t.sentence.comment-level-2 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.4);\r\n\t}\r\n\t.sentence.comment-level-3 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.6);\r\n\t}\r\n\t.sentence.comment-level-4 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.8);\r\n\t}\r\n\t.sentence.comment-level-5 {\r\n\t\tbackground-color: rgba(255, 236, 179, 1);\r\n\t}\r\n\r\n\t.sentence.selected {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.4);\r\n\t}\r\n\r\n\t.annotation-marker {\r\n\t\tcolor: #ff9800;\r\n\t\tfont-size: 0.8em;\r\n\t\tvertical-align: super;\r\n\t\tmargin-left: 2px;\r\n\t}\r\n\r\n\t:deep(.circled-word) {\r\n\t\tposition: relative;\r\n\t\tdisplay: inline-block;\r\n\t\tpadding: 0 2px;\r\n\t\tz-index: 1;\r\n\t}\r\n\r\n\t:deep(.circled-word::before) {\r\n\t\tcontent: \"\";\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: calc(100% + 8px);\r\n\t\theight: calc(100% + 4px);\r\n\t\tborder: var(--circle-border-width, 2px) solid #ff9800;\r\n\t\tborder-radius: 50%;\r\n\t\tbox-sizing: border-box;\r\n\t\tz-index: -1;\r\n\t\topacity: 0.8;\r\n\t\ttransition: all 0.3s ease;\r\n\t}\r\n\r\n\t:deep(.circled-word:hover::before) {\r\n\t\topacity: 1;\r\n\t\tborder-width: calc(var(--circle-border-width, 2px) + 1px);\r\n\t\tbox-shadow: 0 0 5px rgba(0, 0, 0, 0.2);\r\n\t}\r\n</style>\r\n"],"mappings":"AAoBC,SAASA,QAAQ,QAAQ,KAAK;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAE9B,MAAMC,KAAK,GAAGC,OA6CZ;IAEF,MAAMC,IAAI,GAAGC,MAAsB;IAEnC,MAAMC,WAAW,GAAGA,CAAA,KAAM;MACzBF,IAAI,CAAC,OAAO,EAAEF,KAAK,CAACK,aAAa,CAAC;IACnC,CAAC;IAED,MAAMC,YAAY,GAAGC,MAAM,IAAI;MAC9B,OAAOA,MAAM,CAACC,OAAO,CAAC,qBAAqB,EAAE,MAAM,CAAC;IACrD,CAAC;;IAED;IACA,MAAMC,oBAAoB,GAAGC,SAAS,IAAI;MACzC,MAAMC,QAAQ,GAAG,GAAG;MACpB,MAAMC,QAAQ,GAAG,CAAC;MAClB,MAAMC,WAAW,GAAGC,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACN,SAAS,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC;MACxD,MAAMO,WAAW,GAChBN,QAAQ,GAAI,CAACE,WAAW,GAAG,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,IAAKD,QAAQ,GAAGD,QAAQ,CAAC;MAClE,OAAO,GAAGM,WAAW,IAAI;IAC1B,CAAC;IAED,MAAMC,eAAe,GAAGnB,QAAQ,CAAC,MAAM;MACtC,IACC,CAACC,KAAK,CAACmB,aAAa,IACpB,CAACnB,KAAK,CAACoB,kBAAkB,CAACpB,KAAK,CAACK,aAAa,CAAC,EAC7C;QACD,OAAOL,KAAK,CAACqB,QAAQ;MACtB;MAEA,MAAMC,QAAQ,GAAG,CAAC,GAAGtB,KAAK,CAACoB,kBAAkB,CAACpB,KAAK,CAACK,aAAa,CAAC,CAAC;MACnE,IAAIkB,SAAS,GAAGvB,KAAK,CAACqB,QAAQ;MAE9BC,QAAQ,CAACE,IAAI,CAAC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAAC,CAAC,CAAC,GAAGD,CAAC,CAAC,CAAC,CAAC,CAAC;MAEpCH,QAAQ,CAACK,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACC,OAAO,CAAC,CAAAC,KAAA,EAASC,KAAK,KAAK;QAAA,IAAlB,CAACC,IAAI,CAAC,GAAAF,KAAA;QACnC,IAAI7B,KAAK,CAACqB,QAAQ,CAACW,QAAQ,CAACD,IAAI,CAAC,EAAE;UAClC,MAAMrB,SAAS,GACdV,KAAK,CAACoB,kBAAkB,CAACpB,KAAK,CAACK,aAAa,CAAC,CAAC4B,IAAI,CACjDC,IAAI,IAAIA,IAAI,CAAC,CAAC,CAAC,KAAKH,IACrB,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;UAEZ,MAAMI,KAAK,GAAG,IAAIC,MAAM,CAAC9B,YAAY,CAACyB,IAAI,CAAC,EAAE,GAAG,CAAC;UACjDR,SAAS,GAAGA,SAAS,CAACf,OAAO,CAC5B2B,KAAK,EACL;AACL,sCAAsC1B,oBAAoB,CAACC,SAAS,CAAC;AACrE,4BAA4BqB,IAAI,SAC5B,CAAC;QACF;MACD,CAAC,CAAC;MAEF,OAAOR,SAAS;IACjB,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}