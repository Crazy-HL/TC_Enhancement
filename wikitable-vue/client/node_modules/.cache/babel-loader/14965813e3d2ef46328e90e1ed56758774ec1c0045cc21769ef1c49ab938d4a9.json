{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, normalizeStyle as _normalizeStyle, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-69ad0d39\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"danmu-container\",\n  ref: \"danmuContainer\"\n};\nconst _hoisted_2 = {\n  class: \"danmu-user\"\n};\nconst _hoisted_3 = {\n  class: \"danmu-content\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.danmus, danmu => {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: danmu.id,\n      class: \"danmu-item\",\n      style: _normalizeStyle({\n        top: `${danmu.top}px`,\n        left: `${danmu.left}px`,\n        color: danmu.color,\n        'animation-duration': `${danmu.speed}s`\n      })\n    }, [_createElementVNode(\"span\", _hoisted_2, _toDisplayString(danmu.user) + \"：\", 1 /* TEXT */), _createElementVNode(\"span\", _hoisted_3, _toDisplayString(danmu.content), 1 /* TEXT */)], 4 /* STYLE */);\n  }), 128 /* KEYED_FRAGMENT */))], 512 /* NEED_PATCH */);\n}","map":{"version":3,"names":["class","ref","_createElementBlock","_hoisted_1","_Fragment","_renderList","$setup","danmus","danmu","key","id","style","_normalizeStyle","top","left","color","speed","_createElementVNode","_hoisted_2","_toDisplayString","user","_hoisted_3","content"],"sources":["D:\\ZhiHu\\zhihu-bullet\\wikitable-vue\\client\\src\\components\\DanmuDisplay.vue"],"sourcesContent":["<template>\r\n\t<div class=\"danmu-container\" ref=\"danmuContainer\">\r\n\t\t<div\r\n\t\t\tv-for=\"danmu in danmus\"\r\n\t\t\t:key=\"danmu.id\"\r\n\t\t\tclass=\"danmu-item\"\r\n\t\t\t:style=\"{\r\n\t\t\t\ttop: `${danmu.top}px`,\r\n\t\t\t\tleft: `${danmu.left}px`,\r\n\t\t\t\tcolor: danmu.color,\r\n\t\t\t\t'animation-duration': `${danmu.speed}s`\r\n\t\t\t}\">\r\n\t\t\t<span class=\"danmu-user\">{{ danmu.user }}：</span>\r\n\t\t\t<span class=\"danmu-content\">{{ danmu.content }}</span>\r\n\t\t</div>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, watch, onMounted, onUnmounted } from \"vue\";\r\n\r\n\tconst props = defineProps({\r\n\t\tactiveSentence: Number,\r\n\t\tcomments: Array\r\n\t});\r\n\r\n\tconst colorPool = [\r\n\t\t\"#FF6B6B\",\r\n\t\t\"#4ECDC4\",\r\n\t\t\"#45B7D1\",\r\n\t\t\"#FFA07A\",\r\n\t\t\"#98D8C8\",\r\n\t\t\"#F06292\",\r\n\t\t\"#7986CB\",\r\n\t\t\"#9575CD\",\r\n\t\t\"#64B5F6\",\r\n\t\t\"#4DB6AC\",\r\n\t\t\"#81C784\",\r\n\t\t\"#FFD54F\"\r\n\t];\r\n\r\n\tconst danmuContainer = ref(null);\r\n\tconst danmus = ref([]);\r\n\tlet danmuInterval = null;\r\n\r\n\t// 获取某句子的相关评论\r\n\tconst getCommentsForSentence = sentenceIndex => {\r\n\t\treturn props.comments.filter(comment => comment.link === sentenceIndex);\r\n\t};\r\n\r\n\t// 初始化弹幕\r\n\tconst initDanmus = () => {\r\n\t\tconst relatedComments = getCommentsForSentence(props.activeSentence);\r\n\t\tif (relatedComments.length === 0) return;\r\n\r\n\t\tconst containerHeight = danmuContainer.value?.clientHeight || 100;\r\n\t\tconst containerWidth = danmuContainer.value?.clientWidth || 800;\r\n\r\n\t\tdanmus.value = relatedComments.map((comment, i) => ({\r\n\t\t\tid: `${Date.now()}-${i}`,\r\n\t\t\tcontent: comment.content,\r\n\t\t\tuser: comment.user_nickname,\r\n\t\t\tcolor: colorPool[Math.floor(Math.random() * colorPool.length)],\r\n\t\t\ttop: Math.random() * (containerHeight - 30),\r\n\t\t\tleft: containerWidth,\r\n\t\t\tspeed: 10 + Math.random() * 10\r\n\t\t}));\r\n\r\n\t\tstartDanmuAnimation();\r\n\t};\r\n\r\n\t// 开始弹幕动画\r\n\tconst startDanmuAnimation = () => {\r\n\t\tstopDanmuAnimation();\r\n\r\n\t\tdanmuInterval = setInterval(() => {\r\n\t\t\tconst containerWidth = danmuContainer.value?.clientWidth || 800;\r\n\r\n\t\t\tdanmus.value = danmus.value.map(danmu => {\r\n\t\t\t\tconst moveSpeed = containerWidth / (danmu.speed * 20);\r\n\t\t\t\tlet newLeft = danmu.left - moveSpeed;\r\n\r\n\t\t\t\tif (newLeft < -500) {\r\n\t\t\t\t\tnewLeft = containerWidth;\r\n\t\t\t\t\tdanmu.top = Math.random() * (danmuContainer.value.clientHeight - 30);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn { ...danmu, left: newLeft };\r\n\t\t\t});\r\n\t\t}, 50);\r\n\t};\r\n\r\n\t// 停止弹幕动画\r\n\tconst stopDanmuAnimation = () => {\r\n\t\tif (danmuInterval) {\r\n\t\t\tclearInterval(danmuInterval);\r\n\t\t\tdanmuInterval = null;\r\n\t\t}\r\n\t};\r\n\r\n\t// 监听activeSentence变化\r\n\twatch(\r\n\t\t() => props.activeSentence,\r\n\t\tnewVal => {\r\n\t\t\tif (newVal !== null) {\r\n\t\t\t\tinitDanmus();\r\n\t\t\t} else {\r\n\t\t\t\tstopDanmuAnimation();\r\n\t\t\t\tdanmus.value = [];\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\r\n\tonMounted(() => {\r\n\t\t// 初始化容器尺寸\r\n\t\tif (danmuContainer.value) {\r\n\t\t\tdanmuContainer.value.style.height = \"100px\";\r\n\t\t}\r\n\t});\r\n\r\n\tonUnmounted(() => {\r\n\t\tstopDanmuAnimation();\r\n\t});\r\n</script>\r\n\r\n<style scoped>\r\n\t.danmu-container {\r\n\t\tposition: absolute;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100px;\r\n\t\toverflow: hidden;\r\n\t\tz-index: 10;\r\n\t\tpointer-events: none;\r\n\t}\r\n\r\n\t.danmu-item {\r\n\t\tposition: absolute;\r\n\t\twhite-space: nowrap;\r\n\t\tfont-size: 16px;\r\n\t\ttext-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 15px;\r\n\t\tbackground-color: rgba(255, 255, 255, 0.8);\r\n\t\tbox-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\r\n\t\tanimation: danmu-move linear infinite;\r\n\t}\r\n\r\n\t.danmu-user {\r\n\t\tfont-weight: bold;\r\n\t\tmargin-right: 5px;\r\n\t}\r\n\r\n\t@keyframes danmu-move {\r\n\t\tfrom {\r\n\t\t\ttransform: translateX(100%);\r\n\t\t}\r\n\t\tto {\r\n\t\t\ttransform: translateX(-100%);\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":";;;EACMA,KAAK,EAAC,iBAAiB;EAACC,GAAG,EAAC;;;EAWzBD,KAAK,EAAC;AAAY;;EAClBA,KAAK,EAAC;AAAe;;uBAZ7BE,mBAAA,CAcM,OAdNC,UAcM,I,kBAbLD,mBAAA,CAYME,SAAA,QAdRC,WAAA,CAGmBC,MAAA,CAAAC,MAAM,EAAfC,KAAK;yBADbN,mBAAA,CAYM;MAVJO,GAAG,EAAED,KAAK,CAACE,EAAE;MACdV,KAAK,EAAC,YAAY;MACjBW,KAAK,EANTC,eAAA;gBAM0BJ,KAAK,CAACK,GAAG;iBAAoBL,KAAK,CAACM,IAAI;eAAkBN,KAAK,CAACO,KAAK;iCAAgCP,KAAK,CAACQ,KAAK;;QAMtIC,mBAAA,CAAiD,QAAjDC,UAAiD,EAAAC,gBAAA,CAArBX,KAAK,CAACY,IAAI,IAAG,GAAC,iBAC1CH,mBAAA,CAAsD,QAAtDI,UAAsD,EAAAF,gBAAA,CAAvBX,KAAK,CAACc,OAAO,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}