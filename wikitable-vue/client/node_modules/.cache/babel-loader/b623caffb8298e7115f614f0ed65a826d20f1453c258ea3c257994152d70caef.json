{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { ref, onMounted, computed, watch, nextTick } from \"vue\";\nimport api from \"@/api\";\nconst defaultAvatar = \"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iI2NjYyIgZD0iTTEyLDJBMTAsMTAgMCAwLDAgMiwxMkExMCwxMCAwIDAsMCAxMiwyMkExMCwxMCAwIDAsMCAyMiwxMkExMCwxMCAwIDAsMCAxMiwyTTEyLDRBNyA3IDAgMCwxIDE5LDExQTcgNyAwIDAsMSAxMiwxOEE3LDcgMCAwLDEgNSwxMUE3LDcgMCAwLDEgMTIsNE0xMiw2QTUsNSAwIDAsMCA3LDExQTUsNSAwIDAsMCAxMiwxNkE1LDUgMCAwLDAgMTcsMTFBNSw1IDAgMCwwIDEyLDZNMTIsOEEzLDMgMCAwLDEgMTUsMTFBNCw4IDAgMCwxIDEyLDE1QTQsNCAwIDAsMSA5LDExQTMsMyAwIDAsMSAxMiw4WiIvPjwvc3ZnPg==\";\n\n// 数据状态\n\nexport default {\n  __name: 'ArticleContent',\n  setup(__props, _ref) {\n    let {\n      expose: __expose\n    } = _ref;\n    __expose();\n    const article = ref(null);\n    const sentences = ref([]);\n    const comments = ref([]);\n    const activeSentence = ref(null);\n    const articleContainer = ref(null);\n    const annotationPanel = ref(null);\n    const connectionLines = ref(null);\n\n    // 加载状态\n    const isLoading = ref(true);\n    const error = ref(null);\n\n    // 连接线坐标\n    const lineStart = ref({\n      x: 0,\n      y: 0\n    });\n    const lineEnd = ref({\n      x: 0,\n      y: 0\n    });\n\n    // 安全的数据访问方法\n    const safeArray = value => Array.isArray(value) ? value : [];\n    const safeObject = value => typeof value === \"object\" && value !== null ? value : {};\n\n    // 计算属性\n    const globalComments = computed(() => {\n      return safeArray(comments.value).filter(comment => safeObject(comment).link === -1);\n    });\n    const getCommentsForSentence = sentenceIndex => {\n      return safeArray(comments.value).filter(comment => safeObject(comment).link === sentenceIndex);\n    };\n    const hasComments = sentenceIndex => {\n      return getCommentsForSentence(sentenceIndex).length > 0;\n    };\n    const getCommentLevel = sentenceIndex => {\n      const count = getCommentsForSentence(sentenceIndex).length;\n      return count ? Math.min(Math.floor(count / 3) + 1, 5) : 0;\n    };\n\n    // 方法\n    const highlightComments = index => {\n      if (hasComments(index)) {\n        activeSentence.value = index;\n        updateConnectionLine();\n      }\n    };\n    const unhighlightComments = () => {\n      // 保留当前激活状态，让用户点击关闭按钮\n    };\n    const handleAvatarError = e => {\n      e.target.src = defaultAvatar;\n    };\n    const formatTime = timestamp => {\n      if (!timestamp) return \"未知时间\";\n      try {\n        const date = new Date(timestamp * 1000);\n        return date.toLocaleString();\n      } catch {\n        return \"无效时间\";\n      }\n    };\n    const splitIntoSentences = text => {\n      if (!text) return [];\n      try {\n        const regex = /([^。！？.!?]+[。！？.!?]+)/g;\n        const result = [];\n        let match;\n        while ((match = regex.exec(text)) !== null) {\n          const sentence = match[0].trim();\n          if (sentence.length > 0) {\n            result.push(sentence);\n          }\n        }\n        return result.length > 0 ? result : [text];\n      } catch {\n        return [text || \"无内容\"];\n      }\n    };\n    const updateConnectionLine = () => {\n      if (activeSentence.value === null || !articleContainer.value || !annotationPanel.value || !connectionLines.value) return;\n      const sentenceEl = document.getElementById(`sentence-${activeSentence.value}`);\n      if (!sentenceEl) return;\n      nextTick(() => {\n        try {\n          const sentenceRect = sentenceEl.getBoundingClientRect();\n          const panelRect = annotationPanel.value.getBoundingClientRect();\n          const linesRect = connectionLines.value.getBoundingClientRect();\n          lineStart.value = {\n            x: sentenceRect.right - linesRect.left + 5,\n            y: sentenceRect.top + sentenceRect.height / 2 - linesRect.top\n          };\n          lineEnd.value = {\n            x: panelRect.left - linesRect.left - 5,\n            y: panelRect.top + panelRect.height / 2 - linesRect.top\n          };\n        } catch (e) {\n          console.error(\"更新连接线出错:\", e);\n        }\n      });\n    };\n    const retryLoading = async () => {\n      error.value = null;\n      isLoading.value = true;\n      await loadData();\n    };\n    const loadData = async () => {\n      try {\n        const [articleData, commentsData] = await Promise.all([api.get(\"article\", {}).catch(() => []), api.get(\"comments\", {}).catch(() => [])]);\n        article.value = safeArray(articleData)[0] || null;\n        sentences.value = splitIntoSentences(safeObject(article.value).content_text);\n        comments.value = safeArray(commentsData);\n      } catch (err) {\n        error.value = err;\n        console.error(\"加载数据出错:\", err);\n      } finally {\n        isLoading.value = false;\n      }\n    };\n\n    // 生命周期\n    onMounted(() => {\n      loadData();\n      window.addEventListener(\"resize\", updateConnectionLine);\n      window.addEventListener(\"scroll\", updateConnectionLine, true);\n    });\n\n    // 监听器\n    watch(activeSentence, () => {\n      updateConnectionLine();\n    });\n    watch(() => [article.value, comments.value], () => {\n      updateConnectionLine();\n    });\n    const __returned__ = {\n      defaultAvatar,\n      article,\n      sentences,\n      comments,\n      activeSentence,\n      articleContainer,\n      annotationPanel,\n      connectionLines,\n      isLoading,\n      error,\n      lineStart,\n      lineEnd,\n      safeArray,\n      safeObject,\n      globalComments,\n      getCommentsForSentence,\n      hasComments,\n      getCommentLevel,\n      highlightComments,\n      unhighlightComments,\n      handleAvatarError,\n      formatTime,\n      splitIntoSentences,\n      updateConnectionLine,\n      retryLoading,\n      loadData,\n      ref,\n      onMounted,\n      computed,\n      watch,\n      nextTick,\n      get api() {\n        return api;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","onMounted","computed","watch","nextTick","api","defaultAvatar","article","sentences","comments","activeSentence","articleContainer","annotationPanel","connectionLines","isLoading","error","lineStart","x","y","lineEnd","safeArray","value","Array","isArray","safeObject","globalComments","filter","comment","link","getCommentsForSentence","sentenceIndex","hasComments","length","getCommentLevel","count","Math","min","floor","highlightComments","index","updateConnectionLine","unhighlightComments","handleAvatarError","e","target","src","formatTime","timestamp","date","Date","toLocaleString","splitIntoSentences","text","regex","result","match","exec","sentence","trim","push","sentenceEl","document","getElementById","sentenceRect","getBoundingClientRect","panelRect","linesRect","right","left","top","height","console","retryLoading","loadData","articleData","commentsData","Promise","all","get","catch","content_text","err","window","addEventListener"],"sources":["D:/ZhiHu/zhihu-bullet/wikitable-vue/client/src/components/ArticleContent.vue"],"sourcesContent":["<template>\r\n\t<div v-if=\"isLoading\" class=\"loading-indicator\">\r\n\t\t<div class=\"spinner\"></div>\r\n\t\t<p>正在加载内容...</p>\r\n\t</div>\r\n\r\n\t<div v-else-if=\"error\" class=\"error-message\">\r\n\t\t<h3>加载出错</h3>\r\n\t\t<p>{{ error.message }}</p>\r\n\t\t<button @click=\"retryLoading\">重试</button>\r\n\t</div>\r\n\r\n\t<div v-else class=\"article-layout\">\r\n\t\t<!-- 左侧：文章整体评论 -->\r\n\t\t<div\r\n\t\t\tclass=\"left-panel global-comments-panel\"\r\n\t\t\tv-if=\"globalComments.length > 0\">\r\n\t\t\t<div class=\"panel-header\">\r\n\t\t\t\t<h4>文章整体评论 ({{ globalComments.length }})</h4>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel-content\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(comment, index) in globalComments\"\r\n\t\t\t\t\t:key=\"'global-' + index\"\r\n\t\t\t\t\tclass=\"comment-item\">\r\n\t\t\t\t\t<div class=\"comment-user\">\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t:src=\"comment.user_avatar || defaultAvatar\"\r\n\t\t\t\t\t\t\tclass=\"avatar\"\r\n\t\t\t\t\t\t\t@error=\"handleAvatarError\" />\r\n\t\t\t\t\t\t<span class=\"username\">{{\r\n\t\t\t\t\t\t\tcomment.user_nickname || \"匿名用户\"\r\n\t\t\t\t\t\t}}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"comment-text\">{{ comment.content || \"无内容\" }}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 中间：文章内容 -->\r\n\t\t<div\r\n\t\t\tclass=\"center-panel article-container\"\r\n\t\t\tv-if=\"article\"\r\n\t\t\tref=\"articleContainer\">\r\n\t\t\t<h1 class=\"article-title\">{{ article.title || \"无标题\" }}</h1>\r\n\t\t\t<div class=\"article-meta\">\r\n\t\t\t\t<span class=\"author\"\r\n\t\t\t\t\t>作者：{{ article.user_nickname || \"未知作者\" }}</span\r\n\t\t\t\t>\r\n\t\t\t\t<span class=\"publish-time\"\r\n\t\t\t\t\t>发布时间：{{ formatTime(article.created_time) }}</span\r\n\t\t\t\t>\r\n\t\t\t\t<span class=\"update-time\"\r\n\t\t\t\t\t>更新时间：{{ formatTime(article.updated_time) }}</span\r\n\t\t\t\t>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"article-content\">\r\n\t\t\t\t<template v-if=\"sentences.length > 0\">\r\n\t\t\t\t\t<span\r\n\t\t\t\t\t\tv-for=\"(sentence, index) in sentences\"\r\n\t\t\t\t\t\t:key=\"index\"\r\n\t\t\t\t\t\tclass=\"sentence\"\r\n\t\t\t\t\t\t:id=\"'sentence-' + index\"\r\n\t\t\t\t\t\t:class=\"{\r\n\t\t\t\t\t\t\t'has-comment': hasComments(index),\r\n\t\t\t\t\t\t\t[`comment-level-${getCommentLevel(index)}`]: hasComments(index),\r\n\t\t\t\t\t\t\tactive: activeSentence === index\r\n\t\t\t\t\t\t}\"\r\n\t\t\t\t\t\t@mouseenter=\"highlightComments(index)\"\r\n\t\t\t\t\t\t@mouseleave=\"unhighlightComments\">\r\n\t\t\t\t\t\t{{ sentence || \"\" }}\r\n\t\t\t\t\t\t<sup v-if=\"hasComments(index)\" class=\"annotation-marker\">\r\n\t\t\t\t\t\t\t{{ getCommentsForSentence(index).length }}\r\n\t\t\t\t\t\t</sup>\r\n\t\t\t\t\t</span>\r\n\t\t\t\t</template>\r\n\t\t\t\t<div v-else class=\"empty-content\">暂无文章内容</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div class=\"article-footer\">\r\n\t\t\t\t<div class=\"stats\">\r\n\t\t\t\t\t<span class=\"vote-count\">点赞：{{ article.voteup_count || 0 }}</span>\r\n\t\t\t\t\t<span class=\"comment-count\"\r\n\t\t\t\t\t\t>评论：{{ article.comment_count || 0 }}</span\r\n\t\t\t\t\t>\r\n\t\t\t\t</div>\r\n\t\t\t\t<a\r\n\t\t\t\t\t:href=\"article.content_url || '#'\"\r\n\t\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\t\tclass=\"original-link\"\r\n\t\t\t\t\t:class=\"{ disabled: !article.content_url }\">\r\n\t\t\t\t\t阅读原文\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 右侧：批注面板 -->\r\n\t\t<div\r\n\t\t\tclass=\"right-panel annotation-panel\"\r\n\t\t\tv-if=\"activeSentence !== null && hasComments(activeSentence)\"\r\n\t\t\tref=\"annotationPanel\">\r\n\t\t\t<div class=\"panel-header\">\r\n\t\t\t\t<h4>相关批注 ({{ getCommentsForSentence(activeSentence).length }})</h4>\r\n\t\t\t\t<button @click=\"activeSentence = null\" class=\"close-btn\">×</button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel-content\">\r\n\t\t\t\t<div\r\n\t\t\t\t\tv-for=\"(comment, index) in getCommentsForSentence(activeSentence)\"\r\n\t\t\t\t\t:key=\"'annotation-' + index\"\r\n\t\t\t\t\tclass=\"annotation-item\">\r\n\t\t\t\t\t<div class=\"annotation-user\">\r\n\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t:src=\"comment.user_avatar || defaultAvatar\"\r\n\t\t\t\t\t\t\tclass=\"avatar\"\r\n\t\t\t\t\t\t\t@error=\"handleAvatarError\" />\r\n\t\t\t\t\t\t<span class=\"username\">{{\r\n\t\t\t\t\t\t\tcomment.user_nickname || \"匿名用户\"\r\n\t\t\t\t\t\t}}</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"annotation-text\">{{ comment.content || \"无内容\" }}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\r\n\t\t<!-- 连接线容器 -->\r\n\t\t<svg class=\"connection-lines\" ref=\"connectionLines\">\r\n\t\t\t<defs>\r\n\t\t\t\t<marker\r\n\t\t\t\t\tid=\"arrowhead\"\r\n\t\t\t\t\tmarkerWidth=\"12\"\r\n\t\t\t\t\tmarkerHeight=\"8\"\r\n\t\t\t\t\trefX=\"11\"\r\n\t\t\t\t\trefY=\"4\"\r\n\t\t\t\t\torient=\"auto\">\r\n\t\t\t\t\t<polygon points=\"0 0, 12 4, 0 8\" fill=\"#FF5722\" />\r\n\t\t\t\t</marker>\r\n\t\t\t\t<filter id=\"glow\" x=\"-30%\" y=\"-30%\" width=\"160%\" height=\"160%\">\r\n\t\t\t\t\t<feGaussianBlur stdDeviation=\"2\" result=\"blur\" />\r\n\t\t\t\t\t<feComposite in=\"SourceGraphic\" in2=\"blur\" operator=\"over\" />\r\n\t\t\t\t</filter>\r\n\t\t\t\t<filter id=\"shadow\" x=\"-20%\" y=\"-20%\" width=\"140%\" height=\"140%\">\r\n\t\t\t\t\t<feDropShadow\r\n\t\t\t\t\t\tdx=\"1\"\r\n\t\t\t\t\t\tdy=\"1\"\r\n\t\t\t\t\t\tstdDeviation=\"2\"\r\n\t\t\t\t\t\tflood-color=\"rgba(0,0,0,0.3)\" />\r\n\t\t\t\t</filter>\r\n\t\t\t</defs>\r\n\t\t\t<line\r\n\t\t\t\tv-if=\"activeSentence !== null && hasComments(activeSentence)\"\r\n\t\t\t\t:x1=\"lineStart.x\"\r\n\t\t\t\t:y1=\"lineStart.y\"\r\n\t\t\t\t:x2=\"lineEnd.x\"\r\n\t\t\t\t:y2=\"lineEnd.y\"\r\n\t\t\t\tclass=\"connection-line\"\r\n\t\t\t\tmarker-end=\"url(#arrowhead)\" />\r\n\t\t</svg>\r\n\t</div>\r\n</template>\r\n\r\n<script setup>\r\n\timport { ref, onMounted, computed, watch, nextTick } from \"vue\";\r\n\timport api from \"@/api\";\r\n\r\n\tconst defaultAvatar =\r\n\t\t\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iI2NjYyIgZD0iTTEyLDJBMTAsMTAgMCAwLDAgMiwxMkExMCwxMCAwIDAsMCAxMiwyMkExMCwxMCAwIDAsMCAyMiwxMkExMCwxMCAwIDAsMCAxMiwyTTEyLDRBNyA3IDAgMCwxIDE5LDExQTcgNyAwIDAsMSAxMiwxOEE3LDcgMCAwLDEgNSwxMUE3LDcgMCAwLDEgMTIsNE0xMiw2QTUsNSAwIDAsMCA3LDExQTUsNSAwIDAsMCAxMiwxNkE1LDUgMCAwLDAgMTcsMTFBNSw1IDAgMCwwIDEyLDZNMTIsOEEzLDMgMCAwLDEgMTUsMTFBNCw4IDAgMCwxIDEyLDE1QTQsNCAwIDAsMSA5LDExQTMsMyAwIDAsMSAxMiw4WiIvPjwvc3ZnPg==\";\r\n\r\n\t// 数据状态\r\n\tconst article = ref(null);\r\n\tconst sentences = ref([]);\r\n\tconst comments = ref([]);\r\n\tconst activeSentence = ref(null);\r\n\tconst articleContainer = ref(null);\r\n\tconst annotationPanel = ref(null);\r\n\tconst connectionLines = ref(null);\r\n\r\n\t// 加载状态\r\n\tconst isLoading = ref(true);\r\n\tconst error = ref(null);\r\n\r\n\t// 连接线坐标\r\n\tconst lineStart = ref({ x: 0, y: 0 });\r\n\tconst lineEnd = ref({ x: 0, y: 0 });\r\n\r\n\t// 安全的数据访问方法\r\n\tconst safeArray = value => (Array.isArray(value) ? value : []);\r\n\tconst safeObject = value =>\r\n\t\ttypeof value === \"object\" && value !== null ? value : {};\r\n\r\n\t// 计算属性\r\n\tconst globalComments = computed(() => {\r\n\t\treturn safeArray(comments.value).filter(\r\n\t\t\tcomment => safeObject(comment).link === -1\r\n\t\t);\r\n\t});\r\n\r\n\tconst getCommentsForSentence = sentenceIndex => {\r\n\t\treturn safeArray(comments.value).filter(\r\n\t\t\tcomment => safeObject(comment).link === sentenceIndex\r\n\t\t);\r\n\t};\r\n\r\n\tconst hasComments = sentenceIndex => {\r\n\t\treturn getCommentsForSentence(sentenceIndex).length > 0;\r\n\t};\r\n\r\n\tconst getCommentLevel = sentenceIndex => {\r\n\t\tconst count = getCommentsForSentence(sentenceIndex).length;\r\n\t\treturn count ? Math.min(Math.floor(count / 3) + 1, 5) : 0;\r\n\t};\r\n\r\n\t// 方法\r\n\tconst highlightComments = index => {\r\n\t\tif (hasComments(index)) {\r\n\t\t\tactiveSentence.value = index;\r\n\t\t\tupdateConnectionLine();\r\n\t\t}\r\n\t};\r\n\r\n\tconst unhighlightComments = () => {\r\n\t\t// 保留当前激活状态，让用户点击关闭按钮\r\n\t};\r\n\r\n\tconst handleAvatarError = e => {\r\n\t\te.target.src = defaultAvatar;\r\n\t};\r\n\r\n\tconst formatTime = timestamp => {\r\n\t\tif (!timestamp) return \"未知时间\";\r\n\t\ttry {\r\n\t\t\tconst date = new Date(timestamp * 1000);\r\n\t\t\treturn date.toLocaleString();\r\n\t\t} catch {\r\n\t\t\treturn \"无效时间\";\r\n\t\t}\r\n\t};\r\n\r\n\tconst splitIntoSentences = text => {\r\n\t\tif (!text) return [];\r\n\t\ttry {\r\n\t\t\tconst regex = /([^。！？.!?]+[。！？.!?]+)/g;\r\n\t\t\tconst result = [];\r\n\t\t\tlet match;\r\n\t\t\twhile ((match = regex.exec(text)) !== null) {\r\n\t\t\t\tconst sentence = match[0].trim();\r\n\t\t\t\tif (sentence.length > 0) {\r\n\t\t\t\t\tresult.push(sentence);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn result.length > 0 ? result : [text];\r\n\t\t} catch {\r\n\t\t\treturn [text || \"无内容\"];\r\n\t\t}\r\n\t};\r\n\r\n\tconst updateConnectionLine = () => {\r\n\t\tif (\r\n\t\t\tactiveSentence.value === null ||\r\n\t\t\t!articleContainer.value ||\r\n\t\t\t!annotationPanel.value ||\r\n\t\t\t!connectionLines.value\r\n\t\t)\r\n\t\t\treturn;\r\n\r\n\t\tconst sentenceEl = document.getElementById(\r\n\t\t\t`sentence-${activeSentence.value}`\r\n\t\t);\r\n\t\tif (!sentenceEl) return;\r\n\r\n\t\tnextTick(() => {\r\n\t\t\ttry {\r\n\t\t\t\tconst sentenceRect = sentenceEl.getBoundingClientRect();\r\n\t\t\t\tconst panelRect = annotationPanel.value.getBoundingClientRect();\r\n\t\t\t\tconst linesRect = connectionLines.value.getBoundingClientRect();\r\n\r\n\t\t\t\tlineStart.value = {\r\n\t\t\t\t\tx: sentenceRect.right - linesRect.left + 5,\r\n\t\t\t\t\ty: sentenceRect.top + sentenceRect.height / 2 - linesRect.top\r\n\t\t\t\t};\r\n\r\n\t\t\t\tlineEnd.value = {\r\n\t\t\t\t\tx: panelRect.left - linesRect.left - 5,\r\n\t\t\t\t\ty: panelRect.top + panelRect.height / 2 - linesRect.top\r\n\t\t\t\t};\r\n\t\t\t} catch (e) {\r\n\t\t\t\tconsole.error(\"更新连接线出错:\", e);\r\n\t\t\t}\r\n\t\t});\r\n\t};\r\n\r\n\tconst retryLoading = async () => {\r\n\t\terror.value = null;\r\n\t\tisLoading.value = true;\r\n\t\tawait loadData();\r\n\t};\r\n\r\n\tconst loadData = async () => {\r\n\t\ttry {\r\n\t\t\tconst [articleData, commentsData] = await Promise.all([\r\n\t\t\t\tapi.get(\"article\", {}).catch(() => []),\r\n\t\t\t\tapi.get(\"comments\", {}).catch(() => [])\r\n\t\t\t]);\r\n\r\n\t\t\tarticle.value = safeArray(articleData)[0] || null;\r\n\t\t\tsentences.value = splitIntoSentences(\r\n\t\t\t\tsafeObject(article.value).content_text\r\n\t\t\t);\r\n\t\t\tcomments.value = safeArray(commentsData);\r\n\t\t} catch (err) {\r\n\t\t\terror.value = err;\r\n\t\t\tconsole.error(\"加载数据出错:\", err);\r\n\t\t} finally {\r\n\t\t\tisLoading.value = false;\r\n\t\t}\r\n\t};\r\n\r\n\t// 生命周期\r\n\tonMounted(() => {\r\n\t\tloadData();\r\n\r\n\t\twindow.addEventListener(\"resize\", updateConnectionLine);\r\n\t\twindow.addEventListener(\"scroll\", updateConnectionLine, true);\r\n\t});\r\n\r\n\t// 监听器\r\n\twatch(activeSentence, () => {\r\n\t\tupdateConnectionLine();\r\n\t});\r\n\r\n\twatch(\r\n\t\t() => [article.value, comments.value],\r\n\t\t() => {\r\n\t\t\tupdateConnectionLine();\r\n\t\t}\r\n\t);\r\n</script>\r\n\r\n<style scoped>\r\n\t/* 布局样式 */\r\n\t.article-layout {\r\n\t\tdisplay: grid;\r\n\t\tgrid-template-columns: 280px minmax(0, 1fr) 280px;\r\n\t\tgap: 20px;\r\n\t\tmax-width: 1200px;\r\n\t\tmargin: 0 auto;\r\n\t\tpadding: 20px;\r\n\t\tposition: relative;\r\n\t\tmin-height: 80vh;\r\n\t}\r\n\r\n\t/* 加载状态样式 */\r\n\t.loading-indicator {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\theight: 80vh;\r\n\t}\r\n\r\n\t.spinner {\r\n\t\tborder: 4px solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-radius: 50%;\r\n\t\tborder-top: 4px solid #0084ff;\r\n\t\twidth: 40px;\r\n\t\theight: 40px;\r\n\t\tanimation: spin 1s linear infinite;\r\n\t\tmargin-bottom: 16px;\r\n\t}\r\n\r\n\t@keyframes spin {\r\n\t\t0% {\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\r\n\t/* 错误状态样式 */\r\n\t.error-message {\r\n\t\ttext-align: center;\r\n\t\tpadding: 40px;\r\n\t\tcolor: #ff4444;\r\n\t}\r\n\r\n\t.error-message button {\r\n\t\tbackground: #0084ff;\r\n\t\tcolor: white;\r\n\t\tborder: none;\r\n\t\tpadding: 8px 16px;\r\n\t\tborder-radius: 4px;\r\n\t\tcursor: pointer;\r\n\t\tmargin-top: 16px;\r\n\t}\r\n\r\n\t/* 面板通用样式 */\r\n\t.left-panel,\r\n\t.right-panel {\r\n\t\tposition: sticky;\r\n\t\ttop: 20px;\r\n\t\theight: fit-content;\r\n\t\tmax-height: calc(100vh - 40px);\r\n\t\toverflow-y: auto;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 8px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\r\n\t\tpadding: 15px;\r\n\t}\r\n\r\n\t.center-panel {\r\n\t\tgrid-column: 2;\r\n\t\tbackground: white;\r\n\t\tborder-radius: 8px;\r\n\t\tbox-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\r\n\t\tpadding: 20px;\r\n\t\tposition: relative;\r\n\t\twidth: 100%;\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.panel-header {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 12px;\r\n\t\tpadding-bottom: 8px;\r\n\t\tborder-bottom: 1px solid #eee;\r\n\t}\r\n\r\n\t.panel-content {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\tgap: 12px;\r\n\t}\r\n\r\n\t/* 评论项样式 */\r\n\t.comment-item,\r\n\t.annotation-item {\r\n\t\tpadding: 12px;\r\n\t\tbackground: #f9f9f9;\r\n\t\tborder-radius: 6px;\r\n\t\tborder-left: 3px solid #ff9800;\r\n\t}\r\n\r\n\t.comment-user,\r\n\t.annotation-user {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tmargin-bottom: 8px;\r\n\t}\r\n\r\n\t.avatar {\r\n\t\twidth: 24px;\r\n\t\theight: 24px;\r\n\t\tborder-radius: 50%;\r\n\t\tmargin-right: 8px;\r\n\t\tobject-fit: cover;\r\n\t\tbackground-color: #f0f0f0;\r\n\t}\r\n\r\n\t.username {\r\n\t\tfont-size: 14px;\r\n\t\tfont-weight: bold;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.comment-text,\r\n\t.annotation-text {\r\n\t\tfont-size: 14px;\r\n\t\tline-height: 1.5;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t.close-btn {\r\n\t\tbackground: none;\r\n\t\tborder: none;\r\n\t\tfont-size: 20px;\r\n\t\tcursor: pointer;\r\n\t\tcolor: #999;\r\n\t}\r\n\r\n\t.close-btn:hover {\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t/* 文章内容样式 */\r\n\t.article-title {\r\n\t\tfont-size: 24px;\r\n\t\tmargin-bottom: 15px;\r\n\t\tcolor: #333;\r\n\t\tline-height: 1.4;\r\n\t}\r\n\r\n\t.article-meta {\r\n\t\tmargin-bottom: 20px;\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t.article-meta span {\r\n\t\tmargin-right: 15px;\r\n\t}\r\n\r\n\t.article-content {\r\n\t\tfont-size: 16px;\r\n\t\tline-height: 1.8;\r\n\t\tcolor: #333;\r\n\t\tmargin-bottom: 20px;\r\n\t\tposition: relative;\r\n\t}\r\n\r\n\t.empty-content {\r\n\t\tcolor: #999;\r\n\t\tfont-style: italic;\r\n\t\tpadding: 20px 0;\r\n\t\ttext-align: center;\r\n\t}\r\n\r\n\t.sentence {\r\n\t\tdisplay: inline;\r\n\t\tmargin-right: 0.2em;\r\n\t\tposition: relative;\r\n\t\ttransition: all 0.2s;\r\n\t\tpadding: 0 1px;\r\n\t}\r\n\r\n\t/* 评论级别颜色 (1-5) */\r\n\t.sentence.comment-level-1 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.2);\r\n\t}\r\n\t.sentence.comment-level-2 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.4);\r\n\t}\r\n\t.sentence.comment-level-3 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.6);\r\n\t}\r\n\t.sentence.comment-level-4 {\r\n\t\tbackground-color: rgba(255, 236, 179, 0.8);\r\n\t}\r\n\t.sentence.comment-level-5 {\r\n\t\tbackground-color: rgba(255, 236, 179, 1);\r\n\t}\r\n\r\n\t.sentence.active {\r\n\t\toutline: 1px dashed #ff9800;\r\n\t}\r\n\r\n\t.annotation-marker {\r\n\t\tcolor: #ff9800;\r\n\t\tfont-size: 0.8em;\r\n\t\tvertical-align: super;\r\n\t\tmargin-left: 2px;\r\n\t\tcursor: pointer;\r\n\t}\r\n\r\n\t/* 连接线样式 */\r\n\t.connection-lines {\r\n\t\tposition: fixed;\r\n\t\ttop: 0;\r\n\t\tleft: 0;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tpointer-events: none;\r\n\t\tz-index: 100;\r\n\t\toverflow: visible;\r\n\t}\r\n\r\n\t.connection-line {\r\n\t\tstroke: #ff5722;\r\n\t\tstroke-width: 3px;\r\n\t\tstroke-dasharray: 6, 4;\r\n\t\tstroke-linecap: round;\r\n\t\tfilter: url(#glow) url(#shadow);\r\n\t\tanimation: pulse 1.5s infinite alternate;\r\n\t}\r\n\r\n\t@keyframes pulse {\r\n\t\tfrom {\r\n\t\t\tstroke-width: 3px;\r\n\t\t\topacity: 0.9;\r\n\t\t}\r\n\t\tto {\r\n\t\t\tstroke-width: 4px;\r\n\t\t\topacity: 1;\r\n\t\t}\r\n\t}\r\n\r\n\t/* 文章页脚 */\r\n\t.article-footer {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t\tpadding-top: 15px;\r\n\t\tborder-top: 1px solid #eee;\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t.stats span {\r\n\t\tmargin-right: 15px;\r\n\t}\r\n\r\n\t.original-link {\r\n\t\tcolor: #0084ff;\r\n\t\ttext-decoration: none;\r\n\t\tpadding: 4px 8px;\r\n\t\tborder-radius: 4px;\r\n\t}\r\n\r\n\t.original-link:hover:not(.disabled) {\r\n\t\ttext-decoration: underline;\r\n\t}\r\n\r\n\t.original-link.disabled {\r\n\t\tcolor: #999;\r\n\t\tcursor: not-allowed;\r\n\t}\r\n\r\n\t/* 响应式设计 */\r\n\t@media (max-width: 992px) {\r\n\t\t.article-layout {\r\n\t\t\tgrid-template-columns: 1fr;\r\n\t\t}\r\n\r\n\t\t.left-panel,\r\n\t\t.right-panel {\r\n\t\t\tposition: static;\r\n\t\t\tmax-height: none;\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t}\r\n\r\n\t\t.connection-lines {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}